import React, { useState, useEffect } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

const App = () => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [steps, setSteps] = useState(8432);
  const [heartRate, setHeartRate] = useState(72);
  const [speed, setSpeed] = useState(5.2);
  const [distance, setDistance] = useState(4.3);
  const [duration, setDuration] = useState('00:42:18');
  const [isTracking, setIsTracking] = useState(false);
  const [routeData, setRouteData] = useState([]);
  const [healthTips, setHealthTips] = useState([
    "Stay hydrated! Drink water before, during, and after your workout.",
    "Take regular breaks during long walks to prevent fatigue.",
    "Maintain good posture while walking to avoid back pain.",
    "Aim for at least 10,000 steps per day for optimal health.",
    "Stretch before and after exercise to improve flexibility."
  ]);
  const [currentTip, setCurrentTip] = useState(0);

  // Simulate real-time data updates when tracking
  useEffect(() => {
    let interval;
    if (isTracking) {
      interval = setInterval(() => {
        setSteps(prev => prev + Math.floor(Math.random() * 3) + 1);
        setHeartRate(prev => {
          const change = Math.random() * 4 - 2;
          return Math.max(60, Math.min(180, prev + change));
        });
        setSpeed(prev => {
          const change = (Math.random() - 0.5) * 0.8;
          return Math.max(3, Math.min(12, prev + change));
        });
        setDistance(prev => prev + (speed * 0.0167)); // speed in km/h, update every second
      }, 1000);
    }
    return () => clearInterval(interval);
  }, [isTracking, speed]);

  // Rotate health tips every 10 seconds
  useEffect(() => {
    const tipInterval = setInterval(() => {
      setCurrentTip(prev => (prev + 1) % healthTips.length);
    }, 10000);
    return () => clearInterval(tipInterval);
  }, [healthTips.length]);

  // Mock route data for the map
  const mockRoute = [
    { lat: 40.7128, lng: -74.0060 },
    { lat: 40.7135, lng: -74.0055 },
    { lat: 40.7142, lng: -74.0050 },
    { lat: 40.7149, lng: -74.0045 },
    { lat: 40.7156, lng: -74.0040 },
    { lat: 40.7163, lng: -74.0035 },
    { lat: 40.7170, lng: -74.0030 }
  ];

  const startTracking = () => {
    setIsTracking(true);
    setRouteData(mockRoute);
    setSteps(0);
    setDistance(0);
    setDuration('00:00:00');
  };

  const stopTracking = () => {
    setIsTracking(false);
  };

  const formatTime = (seconds) => {
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  // Mock heart rate data for chart
  const heartRateData = [
    { time: '08:00', bpm: 68 },
    { time: '09:00', bpm: 72 },
    { time: '10:00', bpm: 75 },
    { time: '11:00', bpm: 70 },
    { time: '12:00', bpm: 73 },
    { time: '13:00', bpm: 69 },
    { time: '14:00', bpm: 74 }
  ];

  const renderDashboard = () => (
    <div className="space-y-6">
      {/* Health Tip Banner */}
      <div className="bg-gradient-to-r from-green-500 to-teal-500 rounded-2xl p-5 text-white">
        <div className="flex items-center space-x-3">
          <span className="text-2xl">üí°</span>
          <p className="font-medium">{healthTips[currentTip]}</p>
        </div>
      </div>

      {/* Main Stats */}
      <div className="grid grid-cols-2 gap-4">
        <div className="bg-white rounded-xl p-5 shadow-sm border text-center">
          <div className="text-3xl font-bold text-blue-600 mb-1">{steps.toLocaleString()}</div>
          <div className="text-gray-600 text-sm">Steps</div>
        </div>
        <div className="bg-white rounded-xl p-5 shadow-sm border text-center">
          <div className="text-3xl font-bold text-red-500 mb-1">{heartRate}</div>
          <div className="text-gray-600 text-sm">BPM</div>
        </div>
        <div className="bg-white rounded-xl p-5 shadow-sm border text-center">
          <div className="text-3xl font-bold text-purple-600 mb-1">{speed.toFixed(1)}</div>
          <div className="text-gray-600 text-sm">km/h</div>
        </div>
        <div className="bg-white rounded-xl p-5 shadow-sm border text-center">
          <div className="text-3xl font-bold text-orange-600 mb-1">{distance.toFixed(1)}</div>
          <div className="text-gray-600 text-sm">km</div>
        </div>
      </div>

      {/* Duration */}
      <div className="bg-white rounded-xl p-5 shadow-sm border text-center">
        <div className="text-2xl font-bold text-gray-800 mb-1">{duration}</div>
        <div className="text-gray-600 text-sm">Duration</div>
      </div>

      {/* Tracking Controls */}
      <div className="flex justify-center">
        {!isTracking ? (
          <button
            onClick={startTracking}
            className="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full text-lg font-semibold transition-colors flex items-center space-x-2"
          >
            <span>‚ñ∂</span>
            <span>Start Tracking</span>
          </button>
        ) : (
          <button
            onClick={stopTracking}
            className="bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full text-lg font-semibold transition-colors flex items-center space-x-2"
          >
            <span>‚èπ</span>
            <span>Stop Tracking</span>
          </button>
        )}
      </div>

      {/* Heart Rate Chart */}
      <div className="bg-white rounded-2xl p-5 shadow-sm border">
        <h3 className="text-lg font-semibold mb-4 text-center">Heart Rate Today</h3>
        <div className="h-48">
          <ResponsiveContainer width="100%" height="100%">
            <LineChart data={heartRateData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
              <XAxis dataKey="time" stroke="#666" />
              <YAxis stroke="#666" domain={[60, 80]} />
              <Tooltip 
                contentStyle={{ 
                  backgroundColor: 'white', 
                  border: '1px solid #e5e7eb',
                  borderRadius: '8px',
                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'
                }}
              />
              <Line 
                type="monotone" 
                dataKey="bpm" 
                stroke="#ef4444" 
                strokeWidth={3}
                dot={{ fill: '#ef4444', strokeWidth: 2, r: 4 }}
                activeDot={{ r: 6, stroke: '#ef4444', strokeWidth: 2 }}
              />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );

  const renderMap = () => (
    <div className="space-y-6">
      <h2 className="text-2xl font-bold text-gray-800 text-center">Your Route</h2>
      
      {/* Mock Map Visualization */}
      <div className="bg-gradient-to-br from-blue-100 to-green-100 rounded-2xl h-96 relative overflow-hidden">
        {/* Simple route visualization */}
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="w-full h-full relative">
            {/* Grid lines to simulate map */}
            <div className="absolute inset-0 bg-white opacity-20"></div>
            {[...Array(10)].map((_, i) => (
              <div key={i} className="absolute w-full h-px bg-white opacity-30" style={{ top: `${i * 10}%` }}></div>
            ))}
            {[...Array(10)].map((_, i) => (
              <div key={i} className="absolute h-full w-px bg-white opacity-30" style={{ left: `${i * 10}%` }}></div>
            ))}
            
            {/* Route line */}
            <svg className="absolute inset-0 w-full h-full">
              <polyline
                points="10,80 20,75 30,70 40,65 50,60 60,55 70,50 80,45 90,40"
                fill="none"
                stroke="#3b82f6"
                strokeWidth="3"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
              {/* Start marker */}
              <circle cx="10" cy="80" r="4" fill="#10b981" stroke="white" strokeWidth="2"/>
              {/* End marker */}
              <circle cx="90" cy="40" r="4" fill="#ef4444" stroke="white" strokeWidth="2"/>
            </svg>
            
            {/* Legend */}
            <div className="absolute bottom-4 left-4 bg-white bg-opacity-90 rounded-lg p-2 text-xs">
              <div className="flex items-center space-x-2 mb-1">
                <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                <span>Start</span>
              </div>
              <div className="flex items-center space-x-2">
                <div className="w-3 h-3 bg-red-500 rounded-full"></div>
                <span>End</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Route Stats */}
      <div className="grid grid-cols-2 gap-4">
        <div className="bg-white rounded-xl p-4 shadow-sm border text-center">
          <div className="text-xl font-bold text-gray-800">{distance.toFixed(2)} km</div>
          <div className="text-gray-600 text-sm">Total Distance</div>
        </div>
        <div className="bg-white rounded-xl p-4 shadow-sm border text-center">
          <div className="text-xl font-bold text-gray-800">{speed.toFixed(1)} km/h</div>
          <div className="text-gray-600 text-sm">Average Speed</div>
        </div>
      </div>

      {/* Route Details */}
      {routeData.length > 0 && (
        <div className="bg-white rounded-xl p-4 shadow-sm border">
          <h3 className="text-lg font-semibold mb-3">Route Details</h3>
          <div className="space-y-2 text-sm">
            <div className="flex justify-between">
              <span className="text-gray-600">Start Point:</span>
              <span>{routeData[0].lat.toFixed(4)}, {routeData[0].lng.toFixed(4)}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-600">End Point:</span>
              <span>{routeData[routeData.length - 1].lat.toFixed(4)}, {routeData[routeData.length - 1].lng.toFixed(4)}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-600">Waypoints:</span>
              <span>{routeData.length}</span>
            </div>
          </div>
        </div>
      )}
    </div>
  );

  const tabs = [
    { id: 'dashboard', label: 'Dashboard', icon: 'üìä' },
    { id: 'map', label: 'Route Map', icon: 'üó∫Ô∏è' }
  ];

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white shadow-sm border-b">
        <div className="max-w-md mx-auto px-4 py-4">
          <div className="flex justify-center items-center space-x-3">
            <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-green-500 rounded-xl flex items-center justify-center">
              <span className="text-white font-bold text-xl">F</span>
            </div>
            <h1 className="text-xl font-bold text-gray-800">FitTrack</h1>
          </div>
        </div>
      </header>

      {/* Navigation */}
      <nav className="bg-white border-b">
        <div className="max-w-md mx-auto px-4">
          <div className="flex space-x-8 justify-center">
            {tabs.map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${
                  activeTab === tab.id
                    ? 'border-blue-600 text-blue-600'
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
              >
                <span className="mr-1">{tab.icon}</span>
                {tab.label}
              </button>
            ))}
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <main className="max-w-md mx-auto px-4 py-6">
        {activeTab === 'dashboard' && renderDashboard()}
        {activeTab === 'map' && renderMap()}
      </main>

      {/* Bottom Navigation (Mobile-friendly) */}
      <div className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t">
        <div className="max-w-md mx-auto px-4 py-2">
          <div className="flex justify-around">
            {tabs.map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex flex-col items-center py-2 px-3 rounded-lg transition-colors ${
                  activeTab === tab.id
                    ? 'text-blue-600 bg-blue-50'
                    : 'text-gray-500 hover:text-gray-700'
                }`}
              >
                <span className="text-lg mb-1">{tab.icon}</span>
                <span className="text-xs">{tab.label}</span>
              </button>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

export default App;

