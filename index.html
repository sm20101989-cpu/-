<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>3D Past Simple Mega Maze</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #000; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        
        /* –°—Ç–∏–ª–∏ HUD */
        .stats { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.8); color: #00ffcc; padding: 15px; border-radius: 10px; pointer-events: auto; border: 1px solid #00ffcc; }
        #minimap { width: 150px; height: 150px; background: rgba(0,255,200,0.1); border: 1px solid #00ffcc; margin-top: 10px; position: relative; }
        #player-dot { width: 8px; height: 8px; background: #ff0055; position: absolute; border-radius: 50%; transform: translate(-50%, -50%); }
        
        /* –ü—Ä–∏—Ü–µ–ª */
        #crosshair { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); opacity: 0.5; }

        /* –û–∫–Ω–æ –≤–æ–ø—Ä–æ—Å–∞ */
        #quiz-card { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #fff; padding: 30px; border-radius: 20px; display: none; 
            pointer-events: auto; text-align: center; width: 350px; box-shadow: 0 0 40px rgba(0,255,204,0.5);
        }
        .ans-btn { display: block; width: 100%; padding: 12px; margin: 10px 0; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: #007bff; color: white; font-size: 16px; }
        .ans-btn:hover { background: #0056b3; }
        
        #hint { position: absolute; bottom: 15%; width: 100%; text-align: center; color: #fff; font-size: 20px; text-shadow: 2px 2px 4px #000; display: none; }
    </style>
</head>
<body>

<div id="ui-layer">
    <div id="crosshair"></div>
    <div class="stats">
        <div>–û–ß–ö–ò: <span id="score">0</span></div>
        <div>–ñ–ò–ó–ù–ò: <span id="lives">3</span></div>
        <div id="minimap"><div id="player-dot"></div></div>
    </div>
    
    <div id="hint">üõë –ë–ê–†–¨–ï–†! –ö–ª–∏–∫–Ω–∏, —á—Ç–æ–±—ã –≤–∑–ª–æ–º–∞—Ç—å –µ–≥–æ!</div>

    <div id="quiz-card">
        <h2 id="q-text" style="color:#333">?</h2>
        <div id="options"></div>
    </div>
</div>

<script>
// –ö–ê–†–¢–ê –õ–ê–ë–ò–†–ò–ù–¢–ê (1-—Å—Ç–µ–Ω–∞, 0-–ø—É—Ç—å, 2-–±–∞—Ä—å–µ—Ä, 3-–≤—ã—Ö–æ–¥)
const maze = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1],
    [1,0,1,0,1,0,1,1,1,2,1,0,1,0,1,1,1,1,0,1],
    [1,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,1],
    [1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1],
    [1,0,0,0,2,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1],
    [1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,1,0,1],
    [1,0,0,0,0,0,1,0,2,0,1,0,0,0,0,0,0,1,0,1],
    [1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,1,0,1,0,1],
    [1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,2,0,1,0,1],
    [1,0,1,0,1,1,1,2,1,1,1,0,1,0,1,1,1,1,0,1],
    [1,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,1,0,1,1,1,0,1,1,1,1,1,1,1,1,0,1],
    [1,0,1,1,1,0,0,0,1,0,0,0,0,0,2,0,0,0,0,1],
    [1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,2,1],
    [1,1,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1],
    [1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,0,1],
    [1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,3,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

const questions = [
    { q: "Yesterday I ______ (see) a ghost.", a: "saw", opt: ["saw", "seed", "seen"] },
    { q: "She ______ (not/buy) the dress.", a: "didn't buy", opt: ["didn't bought", "not bought", "didn't buy"] },
    { q: "They ______ (be) happy to help.", a: "were", opt: ["was", "were", "been"] },
    { q: "Where ______ (do) you go?", a: "did", opt: ["did", "do", "done"] },
    { q: "I ______ (have) a cat 5 years ago.", a: "had", opt: ["had", "haved", "has"] }
];

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ü–µ–Ω—ã
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0a0a1a);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// –û—Å–≤–µ—â–µ–Ω–∏–µ
const light = new THREE.PointLight(0x00ffcc, 1, 15);
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040, 0.5));

// –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
const wallMat = new THREE.MeshStandardMaterial({ color: 0x222244, roughness: 0.8 });
const barMat = new THREE.MeshStandardMaterial({ color: 0xff0000, emissive: 0xff0000, transparent: true, opacity: 0.8 });
const floorMat = new THREE.MeshStandardMaterial({ color: 0x111111 });

const walls = [], barriers = [];
const geo = new THREE.BoxGeometry(1, 2.5, 1);

maze.forEach((row, z) => {
    row.forEach((type, x) => {
        if(type === 1) {
            const m = new THREE.Mesh(geo, wallMat);
            m.position.set(x, 1.25, z);
            scene.add(m); walls.push(m);
        } else if(type === 2) {
            const m = new THREE.Mesh(new THREE.BoxGeometry(0.8, 2.4, 0.2), barMat);
            m.position.set(x, 1.25, z);
            scene.add(m); barriers.push(m);
        } else if(type === 3) {
            const fin = new THREE.Mesh(new THREE.TorusGeometry(0.3, 0.1), new THREE.MeshBasicMaterial({color: 0x00ff00}));
            fin.position.set(x, 1.25, z);
            scene.add(fin);
        }
    });
});

const floor = new THREE.Mesh(new THREE.PlaneGeometry(40, 40), floorMat);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// –ò–≥—Ä–æ–∫
const player = new THREE.Group();
player.position.set(1, 0, 1);
player.add(camera);
scene.add(player);

let score = 0, lives = 3, activeBarrier = null;
const keys = {};
window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;

// –ö–ª–∏–∫ –ø–æ –±–∞—Ä—å–µ—Ä—É
window.onclick = () => {
    const ray = new THREE.Raycaster();
    ray.setFromCamera(new THREE.Vector2(0,0), camera);
    const hits = ray.intersectObjects(barriers);
    if(hits.length > 0 && hits[0].distance < 2) {
        activeBarrier = hits[0].object;
        showQuiz();
    }
};

function showQuiz() {
    const q = questions[Math.floor(Math.random()*questions.length)];
    document.getElementById('q-text').innerText = q.q;
    const optDiv = document.getElementById('options');
    optDiv.innerHTML = '';
    q.opt.forEach(o => {
        const b = document.createElement('button');
        b.className = 'ans-btn';
        b.innerText = o;
        b.onclick = () => {
            if(o === q.a) {
                score += 10;
                scene.remove(activeBarrier);
                barriers.splice(barriers.indexOf(activeBarrier), 1);
            } else {
                lives--;
                score = Math.max(0, score - 5);
            }
            document.getElementById('quiz-card').style.display = 'none';
            document.getElementById('score').innerText = score;
            document.getElementById('lives').innerText = lives;
            if(lives <= 0) { alert("–í—ã –∑–∞–±–ª—É–¥–∏–ª–∏—Å—å –Ω–∞–≤—Å–µ–≥–¥–∞..."); location.reload(); }
        };
        optDiv.appendChild(b);
    });
    document.getElementById('quiz-card').style.display = 'block';
}

function update() {
    const prev = player.position.clone();
    const speed = 0.08, rotSpeed = 0.04;

    if(keys['KeyW'] || keys['ArrowUp']) player.translateZ(-speed);
    if(keys['KeyS'] || keys['ArrowDown']) player.translateZ(speed);
    if(keys['KeyA'] || keys['ArrowLeft']) player.rotation.y += rotSpeed;
    if(keys['KeyD'] || keys['ArrowRight']) player.rotation.y -= rotSpeed;

    // –ö–æ–ª–ª–∏–∑–∏–∏
    [...walls, ...barriers].forEach(w => {
        if(player.position.distanceTo(w.position) < 0.75) player.position.copy(prev);
    });

    // –•–∏–Ω—Ç
    let isNear = false;
    barriers.forEach(b => { if(player.position.distanceTo(b.position) < 2) isNear = true; });
    document.getElementById('hint').style.display = isNear ? 'block' : 'none';

    // –ú–∏–Ω–∏–∫–∞—Ä—Ç–∞
    document.getElementById('player-dot').style.left = (player.position.x * 7.5) + 'px';
    document.getElementById('player-dot').style.top = (player.position.z * 7.5) + 'px';

    // –§–∏–Ω–∏—à (–∫–ª–µ—Ç–∫–∞ 18, 18)
    if(player.position.distanceTo(new THREE.Vector3(18, 0, 18)) < 1) {
        alert("–°–í–û–ë–û–î–ê! –í—ã –ø—Ä–æ—à–ª–∏ –ª–∞–±–∏—Ä–∏–Ω—Ç. –û—á–∫–∏: " + score);
        location.reload();
    }

    light.position.copy(player.position);
    renderer.render(scene, camera);
    requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
